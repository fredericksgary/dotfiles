#!/usr/bin/env bash

# script for building everything I can't easily get via a package
# manager. essentially it's an ad-hoc, informally-specified,
# bug-ridden, slow implementation of half of nix.

# everything should be installed in userland, in ~/build with symlinks
# from ~/bin.

set -e

sudo apt-get update &&
sudo apt-get install -y wget build-essential asciidoc docbook2x libssl-dev \
     libcurl4-openssl-dev libexpat1-dev gettext

BUILDDIRBASE=~/.install-everything
mkdir -p ~/bin

###
### Emacs
###

# TODO

###
### Git
###

BUILDDIR=$BUILDDIRBASE/git
rm -rf $BUILDDIR && mkdir -p $BUILDDIR && cd $BUILDDIR
wget https://github.com/git/git/archive/v2.10.2.zip
echo '30f27b29ea1ab8df0ed2959ef32b16531133cd447d365065e96f614790c03c09  v2.10.2.zip' | sha256sum -c
unzip v2.10.2.zip
cd git-2.10.2
INSTALLDIR=$BUILDDIR/install
mkdir $INSTALLDIR
make prefix=$INSTALLDIR all doc info
# skipping `install-html` because who even uses that
make prefix=$INSTALLDIR install install-doc install-info
cd -
for FILE in `ls $INSTALLDIR/bin`; do ln -s $INSTALLDIR/bin/$FILE ~/bin/$FILE; done

###
### NodeJS
###

# TODO

###
### Java
###

# TODO

###
### Maven 3
###

BUILDDIR=$BUILDDIRBASE/maven
rm -rf $BUILDDIR && mkdir -p $BUILDDIR && cd $BUILDDIR
wget http://apache.mirrors.tds.net/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
echo '6e3e9c949ab4695a204f74038717aa7b2689b1be94875899ac1b3fe42800ff82  apache-maven-3.3.9-bin.tar.gz' | \
  sha256sum -c
tar xzf apache-maven-3.3.9-bin.tar.gz
rm -f ~/bin/mvn
ln -s $BUILDDIR/apache-maven-3.3.9/bin/mvn ~/bin/mvn


###
### Done
###

echo  $'\n\n---------------------\nInstalled everything!'
