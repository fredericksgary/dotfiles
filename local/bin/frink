#!/usr/bin/env bash

# Generates a URL for a random simpsons screenshot from frinkiac with
# text given by the CLI args;
#
# Shows a one-second preview of the image, then prints the url to
# stdout and copies it to the clipboard

set -e

read key timestamp < <(
  curl -s https://frinkiac.com/api/random | jq -r '"\(.Episode.Key) \(.Frame.Timestamp)"'
)

memetext="$(echo -n "$@" | fold -s -w 28 | base64 | sed "s/\//_/g" | tr -d '\n')"

URL="https://frinkiac.com/meme/$key/$timestamp.jpg?b64lines=$memetext"

F=$(mktemp)

curl -o "$F" -s "$URL"

eog "$F" &

PID=$!
sleep 1
kill "$PID"

echo -n "$URL" | copy
echo "$URL"
